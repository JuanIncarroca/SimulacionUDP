<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulador UDP - Número Perfecto</title>
    <!-- React y ReactDOM desde CDN -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel para compilar JSX en el navegador -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Tailwind CSS para estilos -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fadeIn 0.5s ease-out forwards;
        }
        body {
            background-color: #f9fafb;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Componentes de Iconos (Simulando Lucide-react)
        const MonitorIcon = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="44" height="44" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="20" height="14" x="2" y="3" rx="2"/><line x1="8" x2="16" y1="21" y2="21"/><line x1="12" x2="12" y1="17" y2="21"/></svg>
        );

        const ServerIcon = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="44" height="44" viewBox="0 0 24 24" fill="none" stroke="#4b5563" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="20" height="8" x="2" y="2" rx="2" ry="2"/><rect width="20" height="8" x="2" y="14" rx="2" ry="2"/><line x1="6" x2="6.01" y1="6" y2="6"/><line x1="6" x2="6.01" y1="18" y2="18"/><line x1="10" x2="10.01" y1="6" y2="6"/><line x1="10" x2="10.01" y1="18" y2="18"/></svg>
        );

        const PlayIcon = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="5 3 19 12 5 21 5 3"/></svg>
        );

        const RotateIcon = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>
        );

        const Node = ({ icon, label, ip }) => (
            <div className="flex flex-col items-center w-32 bg-white/80 backdrop-blur-sm p-2 rounded-lg">
                <div className="mb-1 text-gray-600">{icon}</div>
                <div className="font-bold text-gray-800 text-xs sm:text-sm">{ip}</div>
                <div className="text-[10px] text-gray-500 font-mono uppercase tracking-wider">{label}</div>
            </div>
        );

        const PacketArrow = ({ packet, startX, endX }) => {
            const startPos = parseFloat(startX);
            const endPos = parseFloat(endX);
            const midPos = (startPos + endPos) / 2;
            
            return (
                <div className="w-full relative py-4 group animate-fade-in">
                    {/* Tabla de Cabecera Estilo PCAP */}
                    <div 
                        className="absolute -top-16 bg-white border border-gray-400 text-[10px] z-20 shadow-md transition-all duration-300 hover:scale-105"
                        style={{ 
                            width: '160px', 
                            left: `${midPos}%`, 
                            transform: 'translateX(-50%)' 
                        }}
                    >
                        <div className="grid grid-cols-2 border-b border-gray-400 bg-gray-100 font-bold text-gray-700 text-center">
                            <div className="p-1 border-r border-gray-400">IP dest</div>
                            <div className="p-1">IP orig</div>
                        </div>
                        <div className="grid grid-cols-2 border-b border-gray-400 text-center">
                            <div className="p-1 border-r border-gray-400 truncate">{packet.ipDest}</div>
                            <div className="p-1 truncate">{packet.ipOrig}</div>
                        </div>
                        <div className="grid grid-cols-2 border-b border-gray-400 bg-gray-100 font-bold text-gray-700 text-center">
                            <div className="p-1 border-r border-gray-400">Pto dest</div>
                            <div className="p-1">Pto orig</div>
                        </div>
                        <div className="grid grid-cols-2 border-b border-gray-400 text-center">
                            <div className="p-1 border-r border-gray-400">{packet.portDest}</div>
                            <div className="p-1">{packet.portOrig}</div>
                        </div>
                        <div className="p-1 text-center font-bold text-red-600 bg-white min-h-[1.5rem] flex items-center justify-center">
                            {packet.message}
                        </div>
                    </div>

                    {/* Representación de la Flecha */}
                    <svg className="w-full h-10 overflow-visible">
                        <defs>
                            <marker
                                id={`arrowhead-${packet.id}`}
                                markerWidth="10"
                                markerHeight="7"
                                refX="9"
                                refY="3.5"
                                orient="auto"
                            >
                                <polygon points="0 0, 10 3.5, 0 7" fill="#4b5563" />
                            </marker>
                        </defs>
                        <line
                            x1={`${startX}`}
                            y1="10"
                            x2={`${endX}`}
                            y2="30"
                            stroke="#4b5563"
                            strokeWidth="2"
                            markerEnd={`url(#arrowhead-${packet.id})`}
                            className="drop-shadow-sm"
                        />
                    </svg>
                </div>
            );
        };

        const App = () => {
            const [visiblePackets, setVisiblePackets] = useState([]);
            const [isPlaying, setIsPlaying] = useState(false);

            const packets = [
                { id: 1, from: 'client1', to: 'server', ipOrig: '192.168.0.2', ipDest: '192.168.0.1', portOrig: '49152', portDest: '5000', message: '6', type: 'request' },
                { id: 2, from: 'server', to: 'client1', ipOrig: '192.168.0.1', ipDest: '192.168.0.2', portOrig: '5000', portDest: '49152', message: 'Es PERFECTO', type: 'response' },
                { id: 3, from: 'client2', to: 'server', ipOrig: '192.168.0.3', ipDest: '192.168.0.1', portOrig: '51234', portDest: '5000', message: '12', type: 'request' },
                { id: 4, from: 'server', to: 'client2', ipOrig: '192.168.0.1', ipDest: '192.168.0.3', portOrig: '5000', portDest: '51234', message: 'NO es perfecto', type: 'response' }
            ];

            useEffect(() => {
                let interval;
                if (isPlaying && visiblePackets.length < packets.length) {
                    interval = setInterval(() => {
                        setVisiblePackets((prev) => [...prev, packets[prev.length]]);
                    }, 1500);
                } else if (visiblePackets.length === packets.length) {
                    setIsPlaying(false);
                }
                return () => clearInterval(interval);
            }, [isPlaying, visiblePackets]);

            const reset = () => {
                setVisiblePackets([]);
                setIsPlaying(false);
            };

            const getXPosition = (node) => {
                if (node === 'client1') return '15%';
                if (node === 'server') return '85%';
                if (node === 'client2') return '50%';
                return '0%';
            };

            return (
                <div className="flex flex-col items-center justify-start min-h-screen p-4 md:p-8">
                    <div className="max-w-4xl w-full bg-white rounded-xl shadow-lg p-6 border border-gray-200 overflow-hidden">
                        <div className="flex justify-between items-center mb-10 border-b pb-4">
                            <div>
                                <h1 className="text-2xl font-bold text-gray-800">Simulador UDP Perfecto</h1>
                                <p className="text-xs text-gray-500 italic uppercase tracking-widest">Frame 92+ | UDPPERFECTO.pcapng</p>
                            </div>
                            <div className="flex gap-2">
                                <button 
                                    onClick={() => setIsPlaying(true)}
                                    disabled={isPlaying || visiblePackets.length === packets.length}
                                    className="flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-all disabled:opacity-50 font-medium active:scale-95 shadow-md shadow-blue-200"
                                >
                                    <PlayIcon /> Simular
                                </button>
                                <button 
                                    onClick={reset}
                                    className="flex items-center gap-2 bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-lg transition-all font-medium active:scale-95 border border-gray-200"
                                >
                                    <RotateIcon /> Reiniciar
                                </button>
                            </div>
                        </div>

                        {/* Diagrama */}
                        <div className="relative min-h-[750px] w-full border-x border-dashed border-gray-200 pt-32 pb-10">
                            
                            {/* Nodos */}
                            <div className="flex justify-between items-start absolute top-4 left-0 w-full px-4 z-30">
                                <Node icon={<MonitorIcon />} label="Cliente 1" ip="192.168.0.2" />
                                <Node icon={<MonitorIcon />} label="Cliente 2" ip="192.168.0.3" />
                                <Node icon={<ServerIcon />} label="Servidor UDP" ip="192.168.0.1" />
                            </div>

                            {/* Lifelines */}
                            <div className="absolute top-8 bottom-0 left-[15%] w-px bg-gray-300"></div>
                            <div className="absolute top-8 bottom-0 left-[50%] w-px bg-gray-300"></div>
                            <div className="absolute top-8 bottom-0 left-[85%] w-px bg-gray-300"></div>

                            {/* Mensajes */}
                            <div className="mt-24 space-y-24 flex flex-col items-center relative z-10">
                                {visiblePackets.map((pkt) => (
                                    <PacketArrow 
                                        key={pkt.id} 
                                        packet={pkt} 
                                        startX={getXPosition(pkt.from)} 
                                        endX={getXPosition(pkt.to)} 
                                    />
                                ))}
                            </div>
                        </div>
                    </div>
                    
                    <div className="mt-6 text-[10px] text-gray-400 text-center uppercase tracking-widest leading-relaxed">
                        Datos extraídos de cabeceras IP/UDP registradas <br/>
                        Visualización técnica de capas 3 y 4
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
